<?xml version='1.0' encoding='utf-8'?>
<configDoc date="2025-05-13 20:33:58" fileName="03_data_transformation.plan" runtimeVersion="15.2.0.240425-7925-ed10bffb" cfgFilePath="workspace://Training (2)/Training_commented/plans/03_data_transformation.plan" screen="images/screen_03_data_transformation.plan.png" companyImage="images/logo_about.png" version="1.0">
  <generatorMeta date="2025-05-14 01:05:25" about="{1}

Version: {4} 
Runtime: {5} 
Build: {6} 

Copyright Â© 2002-{3} {2}. All rights reserved.

Your use of the product is subject to the {0} end user license agreement." name="Ataccama ONE Desktop" company="Ataccama Corporation"/>
  <configAlg image="images/TextFileReader.large.png" name="client_tiers (Text File Reader)" class="com.ataccama.dqc.tasks.io.text.read.TextFileReader">
    <properties lineMaxReadLength="65536" fileName="../data/in/client_tiers.csv" fieldSeparator=";" stringQualifierEscape="" numberOfLinesInFooter="0" compression="NONE" encoding="UTF-8" lineSeparator="\r\n" stringQualifier="" numberOfLinesInHeader="1">
      <columns>
        <textReaderColumn name="code" ignore="false" type="STRING"/>
        <textReaderColumn name="name" ignore="false" type="STRING"/>
        <textReaderColumn name="name_fr" ignore="false" type="STRING"/>
        <textReaderColumn name="name_it" ignore="false" type="STRING"/>
      </columns>
      <dataFormatParameters falseValue="false" dateTimeFormat="yy-MM-dd HH:mm:ss" decimalSeparator="." dayFormat="yy-MM-dd" trueValue="true" dateFormatLocale="en_US" thousandsSeparator=""/>
      <errorHandlingStrategy rejectFileName="rejected.txt">
        <errorInstructions>
          <errorInstruction dataStrategy="READ_POSSIBLE" errorType="EXTRA_DATA" putToLog="true" putToReject="false"/>
          <errorInstruction dataStrategy="STOP" errorType="LONG_LINE" putToLog="true" putToReject="true"/>
          <errorInstruction dataStrategy="STOP" errorType="PROCESSING_ERROR" putToLog="true" putToReject="false"/>
          <errorInstruction dataStrategy="READ_POSSIBLE" errorType="INVALID_DATE" putToLog="true" putToReject="false"/>
          <errorInstruction dataStrategy="READ_POSSIBLE" errorType="SHORT_LINE" putToLog="true" putToReject="true"/>
          <errorInstruction dataStrategy="NULL_VALUE" errorType="UNPARSABLE_FIELD" putToLog="true" putToReject="false"/>
        </errorInstructions>
      </errorHandlingStrategy>
      <shadowColumns/>
    </properties>
  </configAlg>
  <configAlg image="images/TextFileReader.large.png" name="party_full_1 (Text File Reader)" class="com.ataccama.dqc.tasks.io.text.read.TextFileReader">
    <properties lineMaxReadLength="65536" fileName="../data/in/party_full_1.csv" fieldSeparator=";" stringQualifierEscape="&quot;" numberOfLinesInFooter="0" compression="NONE" encoding="ISO-8859-1" lineSeparator="\r\n" stringQualifier="&quot;" numberOfLinesInHeader="1">
      <columns>
        <textReaderColumn name="src_name" ignore="false" type="STRING"/>
        <textReaderColumn name="src_gender" ignore="false" type="STRING"/>
        <textReaderColumn name="src_birth_date" ignore="false" type="STRING"/>
        <textReaderColumn name="src_sin" ignore="false" type="STRING"/>
        <textReaderColumn name="src_card" ignore="false" type="STRING"/>
        <textReaderColumn name="src_address" ignore="false" type="STRING"/>
        <textReaderColumn name="src_email" ignore="false" type="STRING"/>
        <textReaderColumn name="src_primary_key" ignore="false" type="STRING"/>
        <textReaderColumn name="meta_last_update" ignore="false" type="DATE">
          <dataFormatParameters dayFormat="yyyy/MM/dd" dateFormatLocale="en" thousandsSeparator=""/>
        </textReaderColumn>
        <textReaderColumn name="src_tier" ignore="false" type="STRING"/>
      </columns>
      <dataFormatParameters falseValue="false" dateTimeFormat="yy-MM-dd HH:mm:ss" decimalSeparator="." dayFormat="yy-MM-dd" trueValue="true" dateFormatLocale="en_US" thousandsSeparator=""/>
      <errorHandlingStrategy rejectFileName="rejected.txt">
        <errorInstructions>
          <errorInstruction dataStrategy="READ_POSSIBLE" errorType="EXTRA_DATA" putToLog="true" putToReject="false"/>
          <errorInstruction dataStrategy="STOP" errorType="LONG_LINE" putToLog="true" putToReject="true"/>
          <errorInstruction dataStrategy="STOP" errorType="PROCESSING_ERROR" putToLog="true" putToReject="false"/>
          <errorInstruction dataStrategy="READ_POSSIBLE" errorType="INVALID_DATE" putToLog="true" putToReject="false"/>
          <errorInstruction dataStrategy="READ_POSSIBLE" errorType="SHORT_LINE" putToLog="true" putToReject="true"/>
          <errorInstruction dataStrategy="NULL_VALUE" errorType="UNPARSABLE_FIELD" putToLog="true" putToReject="false"/>
        </errorInstructions>
      </errorHandlingStrategy>
      <shadowColumns/>
    </properties>
  </configAlg>
  <configAlg image="images/AlterFormat.large.png" name="Add columns (Alter Format)" class="com.ataccama.dqc.tasks.flow.AlterFormat">
    <properties>
      <addedColumns>
        <addedColumn expression="upper(src_name)" name="upper_name" type="STRING"/>
        <addedColumn expression="toLong(trashNonDigits(src_sin))" name="sin_number" type="LONG"/>
        <addedColumn expression="replace(src_email,&#39;gmail&#39;,&#39;googlemail&#39;)" name="fix_email" type="STRING"/>
        <addedColumn name="current_year" type="INTEGER"/>
        <addedColumn name="age" type="INTEGER"/>
        <addedColumn name="trans_name" type="STRING"/>
        <addedColumn name="trans_email" type="STRING"/>
        <addedColumn name="user" type="STRING"/>
        <addedColumn name="domain" type="STRING"/>
      </addedColumns>
      <removedColumns/>
    </properties>
  </configAlg>
  <configAlg image="images/Join.large.png" name="Enrich data with english client tier names+change order of output columns (Join)" class="com.ataccama.dqc.tasks.merge.Join">
    <properties matchStrategy="MERGE" leftKey="src_tier" rightKey="code" joinType="LEFT">
      <columnDefinitions>
        <columnDefinition expression="in_left.src_primary_key" name="src_primary_key"/>
        <columnDefinition expression="in_left.src_name" name="src_name"/>
        <columnDefinition expression="in_left.trans_name" name="trans_name"/>
        <columnDefinition expression="in_left.src_gender" name="src_gender"/>
        <columnDefinition expression="in_left.src_birth_date" name="src_birth_date"/>
        <columnDefinition expression="in_left.src_sin" name="src_sin"/>
        <columnDefinition expression="in_left.sin_number" name="sin_number"/>
        <columnDefinition expression="in_left.src_card" name="src_card"/>
        <columnDefinition expression="in_left.src_address" name="src_address"/>
        <columnDefinition expression="in_left.src_email" name="src_email"/>
        <columnDefinition expression="in_left.trans_email" name="trans_email"/>
        <columnDefinition expression="in_left.fix_email" name="fix_email"/>
        <columnDefinition expression="in_left.user" name="user"/>
        <columnDefinition expression="in_left.domain" name="domain"/>
        <columnDefinition expression="in_left.meta_last_update" name="meta_last_update"/>
        <columnDefinition expression="in_left.src_tier" name="src_tier"/>
        <columnDefinition expression="in_right.name" name="client_tier_name"/>
        <columnDefinition expression="in_left.upper_name" name="upper_name"/>
        <columnDefinition expression="in_left.current_year" name="current_year"/>
        <columnDefinition expression="in_left.age" name="age"/>
      </columnDefinitions>
    </properties>
  </configAlg>
  <configAlg image="images/ExtractFilter.large.png" name="Extract platinum tiers (Extract Filter)" class="com.ataccama.dqc.tasks.conditions.ExtractFilter">
    <properties>
      <condition>client_tier_name = &#39;Platinum&#39;
</condition>
    </properties>
  </configAlg>
  <configAlg image="images/Condition.large.png" name="src_card starts with 4? (Condition)" class="com.ataccama.dqc.tasks.conditions.Condition">
    <properties condition="left(src_card,1)=&#39;4&#39;"/>
  </configAlg>
  <configAlg image="images/AlterFormat.large.png" name="Remove columns (Alter Format)" class="com.ataccama.dqc.tasks.flow.AlterFormat">
    <properties>
      <addedColumns/>
      <removedColumns>
        <columnRef name="src_gender"/>
        <columnRef name="src_birth_date"/>
        <columnRef name="src_sin"/>
        <columnRef name="src_address"/>
        <columnRef name="src_email"/>
        <columnRef name="meta_last_update"/>
        <columnRef name="src_tier"/>
        <columnRef name="upper_name"/>
        <columnRef name="sin_number"/>
        <columnRef name="fix_email"/>
      </removedColumns>
    </properties>
  </configAlg>
  <configAlg image="images/TextFileWriter.large.png" name="Platinum clients with src_cards not starting with 4 (Text File Writer)" class="com.ataccama.dqc.tasks.io.text.write.TextFileWriter">
    <properties writeHeader="false" fileName="../data/out/party_out_plat_not4.csv" fieldSeparator=";" generateMetadata="true" stringQualifierEscape="&quot;" writeAllColumns="true" compression="NONE" encoding="UTF-8" lineSeparator="\r\n" stringQualifier="&quot;" useStringQualifierOnAllColumns="false">
      <columns/>
      <dataFormatParameters falseValue="false" dateTimeFormat="yyyy-MM-dd HH:mm:ss" decimalSeparator="." dayFormat="yyyy-MM-dd" trueValue="true" dateFormatLocale="en_US" thousandsSeparator=""/>
    </properties>
  </configAlg>
  <configAlg image="images/AlterFormat.large.png" name="Remove columns 2 (Alter Format)" class="com.ataccama.dqc.tasks.flow.AlterFormat">
    <properties>
      <addedColumns/>
      <removedColumns>
        <columnRef name="src_gender"/>
        <columnRef name="src_birth_date"/>
        <columnRef name="src_sin"/>
        <columnRef name="src_address"/>
        <columnRef name="src_email"/>
        <columnRef name="meta_last_update"/>
        <columnRef name="src_tier"/>
        <columnRef name="upper_name"/>
        <columnRef name="sin_number"/>
        <columnRef name="fix_email"/>
      </removedColumns>
    </properties>
  </configAlg>
  <configAlg image="images/TextFileWriter.large.png" name="Platinum clients with src_cards starting with 4 (Text File Writer)" class="com.ataccama.dqc.tasks.io.text.write.TextFileWriter">
    <properties writeHeader="true" fileName="../data/out/party_out_plat_4.csv" fieldSeparator=";" generateMetadata="true" stringQualifierEscape="&quot;" writeAllColumns="true" compression="NONE" encoding="UTF-8" lineSeparator="\r\n" stringQualifier="&quot;" useStringQualifierOnAllColumns="false">
      <columns/>
      <dataFormatParameters falseValue="false" dateTimeFormat="yyyy-MM-dd HH:mm:ss" decimalSeparator="." dayFormat="yyyy-MM-dd" trueValue="true" dateFormatLocale="en_US" thousandsSeparator=""/>
    </properties>
  </configAlg>
  <configAlg image="images/Multiplicator.large.png" name="Multiplicator (Multiplicator)" class="com.ataccama.dqc.tasks.flow.Multiplicator">
    <properties/>
  </configAlg>
  <configAlg image="images/AlterFormat.large.png" name="Add contact type and contact info columns for &quot;Address&quot; contact types (Alter Format)" class="com.ataccama.dqc.tasks.flow.AlterFormat">
    <properties>
      <addedColumns>
        <addedColumn expression="&#39;ADDRESS&#39;" name="contact_type" type="STRING"/>
        <addedColumn expression="src_address" name="contact_info" type="STRING"/>
      </addedColumns>
      <removedColumns/>
    </properties>
  </configAlg>
  <configAlg image="images/ColumnAssigner.large.png" name="Assign expressions to fix_email, current_year and age (Column Assigner)" class="com.ataccama.dqc.tasks.expressions.ColumnAssigner">
    <properties>
      <assignments>
        <assignment expression="upper(fix_email)" column="fix_email">
          <scorer>
            <scoringEntries>
              <scoringEntry explain="false" score="0" explainAs="CA_CHANGED" key="CA_CHANGED"/>
            </scoringEntries>
          </scorer>
        </assignment>
        <assignment expression="datePart(today(),&quot;YEAR&quot;)" column="current_year">
          <scorer>
            <scoringEntries/>
          </scorer>
        </assignment>
        <assignment expression="dateDiff(toDate(src_birth_date,&quot;yyyy-MM-dd&quot;),today(),&quot;YEAR&quot;)" column="age">
          <scorer>
            <scoringEntries>
              <scoringEntry explain="false" score="0" explainAs="CA_CHANGED" key="CA_CHANGED"/>
            </scoringEntries>
          </scorer>
        </assignment>
      </assignments>
    </properties>
  </configAlg>
  <configAlg image="images/TransliterateAlgorithm.large.png" name="Convert variations of &quot;smith&quot;to a defined set of variations of &quot;smyth&quot; (Transliterate)" class="com.ataccama.dqc.tasks.clean.transliterate.TransliterateAlgorithm">
    <properties>
      <columns>
        <fromColumnToColumn from="src_name" to="trans_name">
          <scorer>
            <scoringEntries/>
          </scorer>
        </fromColumnToColumn>
        <fromColumnToColumn from="src_email" to="trans_email">
          <scorer>
            <scoringEntries>
              <scoringEntry explain="true" score="0" explainAs="TLT_NULL" key="TLT_NULL"/>
              <scoringEntry explain="true" score="0" explainAs="TLT_CHANGED" key="TLT_CHANGED"/>
            </scoringEntries>
          </scorer>
        </fromColumnToColumn>
      </columns>
      <rules>
        <substitutionRule from="Smith" to="Smyth"/>
        <substitutionRule from="smith" to="smyth"/>
        <substitutionRule from="SMITH" to="SMYTH"/>
      </rules>
    </properties>
  </configAlg>
  <configAlg image="images/RegexMatchingAlgorithm.large.png" name="Extracts values in &quot;fix_email&quot; using Email pattern of Regular expression (Regex Matching)" class="com.ataccama.dqc.tasks.clean.RegexMatchingAlgorithm">
    <properties expression="fix_email" appendRegexNameColumnSeparator=" " appendRegexNameColumn="false">
      <noMatchColumns/>
      <regExpressions>
        <regExpression partialMatch="false" ignoreCase="false" name="Email" pattern="^([\d\p{L}!#$%&amp;&#39;/\.=?^_`|}{~-]{1,127})@([\d\p{L}&#39;\.\-]{1,127})$" multiplicative="false">
          <resultColumns>
            <regexOutputColumn substitution="$1" name="user"/>
            <regexOutputColumn substitution="$2" name="domain"/>
          </resultColumns>
        </regExpression>
      </regExpressions>
      <scorer>
        <scoringEntries>
          <scoringEntry explain="true" score="0" explainAs="STN_NULL" key="STN_NULL"/>
          <scoringEntry explain="true" score="0" explainAs="STN_MATCHED" key="STN_MATCHED"/>
          <scoringEntry explain="true" score="0" explainAs="STN_NOT_MATCHED" key="STN_NOT_MATCHED"/>
        </scoringEntries>
      </scorer>
    </properties>
  </configAlg>
  <configAlg image="images/SortEngine.large.png" name="Order by src_name (Sort)" class="com.ataccama.dqc.tasks.identify.sort.SortEngine">
    <properties>
      <sort>
        <orderBy expression="src_name" nullsFirst="false" orderDescending="false"/>
      </sort>
    </properties>
  </configAlg>
  <configAlg image="images/TextFileWriter.large.png" name="Enriched data order by src_name (Text File Writer)" class="com.ataccama.dqc.tasks.io.text.write.TextFileWriter">
    <properties writeHeader="true" fileName="../data/out/party_out_all.csv" fieldSeparator=";" generateMetadata="true" stringQualifierEscape="&quot;" writeAllColumns="true" compression="NONE" encoding="UTF-8" lineSeparator="\r\n" stringQualifier="&quot;" useStringQualifierOnAllColumns="false">
      <columns/>
      <dataFormatParameters falseValue="false" dateTimeFormat="yyyy-MM-dd HH:mm:ss" decimalSeparator="." dayFormat="yyyy-MM-dd" trueValue="true" dateFormatLocale="en_US" thousandsSeparator=""/>
    </properties>
  </configAlg>
  <configAlg image="images/AlterFormat.large.png" name="Add contact type and contact info columns for &quot;Email&quot; contact types (Alter Format)" class="com.ataccama.dqc.tasks.flow.AlterFormat">
    <properties>
      <addedColumns>
        <addedColumn expression="&#39;EMAIL&#39;" name="contact_type" type="STRING"/>
        <addedColumn expression="fix_email" name="contact_info" type="STRING"/>
      </addedColumns>
      <removedColumns/>
    </properties>
  </configAlg>
  <configAlg image="images/UnionSame.large.png" name="Append Email &amp; Contact account info (Union Same)" class="com.ataccama.dqc.tasks.conditions.UnionSame">
    <properties/>
  </configAlg>
  <configAlg image="images/Filter.large.png" name="Filter records with empty contact information (Filter)" class="com.ataccama.dqc.tasks.conditions.Filter">
    <properties condition="contact_info is null"/>
  </configAlg>
  <configAlg image="images/JdbcWriter.large.png" name="Contact extract (Jdbc Writer)" class="com.ataccama.dqc.tasks.io.jdbc.write.JdbcWriter">
    <properties quoteAllIdentifiers="false" commitSize="0" writeAllColumns="false" batchSize="1000" dataSourceName="PostgreSQL" tableName="CONTACT">
      <columns>
        <columnExprDef name="contact_type"/>
        <columnExprDef name="contact_info"/>
        <columnExprDef name="src_primary_key"/>
      </columns>
    </properties>
  </configAlg>
</configDoc>